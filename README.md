# Reelify



## ğŸ’¡ í”„ë¡œì íŠ¸ ì†Œê°œ

### âš™ ê°œìš”

- ì§„í–‰ ê¸°ê°„ : 2024/11/18 ~ 2024/11/26
- ì†Œê°œ : ì˜í™” ì •ë³´ ì œê³µ ë° ì»¤ë®¤ë‹ˆí‹° ì„œë¹„ìŠ¤
  

### âš™ ê°œë°œ í™˜ê²½ ë° ê¸°ìˆ 

  
![npm](https://img.shields.io/badge/npm-v10.9.0-green) ![pip](https://img.shields.io/badge/pip-v22.0.4-blue)

![Python](https://img.shields.io/badge/python-3670A0?style=for-the-badge&logo=python&logoColor=ffdd54)![JavaScript](https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black)![HTML5](https://img.shields.io/badge/html5-%23E34F26.svg?style=for-the-badge&logo=html5&logoColor=white)![CSS3](https://img.shields.io/badge/css3-%231572B6.svg?style=for-the-badge&logo=css3&logoColor=white)
  
![Django](https://img.shields.io/badge/django-%23092E20.svg?style=for-the-badge&logo=django&logoColor=white)![Vue.js](https://img.shields.io/badge/vuejs-%2335495e.svg?style=for-the-badge&logo=vuedotjs&logoColor=%234FC08D)
  
![Bootstrap](https://img.shields.io/badge/Bootstrap-563D7C?style=for-the-badge&logo=bootstrap&logoColor=white)

![Visual Studio Code](https://img.shields.io/badge/Visual%20Studio%20Code-0078d7.svg?style=for-the-badge&logo=visual-studio-code&logoColor=white)

### âš™ íŒ€ êµ¬ì„±

|       |  Github  |  ì—­í•   |
|:------------:|:------------:|:------------:|
| **ê¹€ì‹œì•„** (ì¡°ì¥)  |  [thesiakim](https://github.com/thesiakim)  |  Backend, Frontend  |
| **ê°•ì€ìˆ˜** |  [eeunxxu](https://github.com/eeunxxu)  |  Frontend  |

## ğŸ§¬ ì„œë¹„ìŠ¤ ì†Œê°œ
### âš™ ê¸°íš

- TMDB APIë¥¼ í†µí•´ ì˜í™”ì™€ ê´€ë ¨ëœ ì •ë³´(ì¤„ê±°ë¦¬, ë°°ìš°, ê°ë…, ë™ì˜ìƒ)ë¥¼ ì œê³µ
- ê°œì¸ë³„ ë§ì¶¤ ì˜í™” ì¶”ì²œ ì„œë¹„ìŠ¤ ì œê³µ
- ì˜í™” ë¦¬ë·°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì»¤ë®¤ë‹ˆí‹° ì„œë¹„ìŠ¤ ì œê³µ 

### âš™ ERD

![ERD](https://github.com/user-attachments/assets/33146c82-eafd-4318-ae2c-b9db0d2c8bd4)

- Movie í…Œì´ë¸”ì„ ì¤‘ì‹¬ìœ¼ë¡œ Actor, Genre, Director, Country, ProviderëŠ” ë‹¤ëŒ€ë‹¤ ê´€ê³„ì´ë©° VideoëŠ” ì¼ëŒ€ë‹¤ ê´€ê³„
- Comment í…Œì´ë¸”ì—ëŠ” parent_commend_idë¥¼ ì§€ì •í•˜ì—¬ ëŒ“ê¸€-ëŒ€ëŒ“ê¸€ì„ ìœ„í•œ ê³„ì¸µ êµ¬ì¡° ì„¤ì •

### âš™ Components Map


### âš™ íšŒì›ê°€ì…

(ì‚¬ì§„)

- dj-rest-authê°€ ì œê³µí•˜ëŠ” ì´ë©”ì¼ ì¸ì¦ í”„ë¡œì„¸ìŠ¤ í™œìš©
- íšŒì›ê°€ì… ì‹œ ì´ë©”ì¼ ì£¼ì†Œ ë° ì„ íƒí•œ ì˜í™” ì •ë³´ë¥¼ í¬í•¨í•  ìˆ˜ ìˆë„ë¡ CustomRegisterSerializer ì—…ë°ì´íŠ¸
- ì¸ì¦ë²ˆí˜¸ëŠ” ìµœëŒ€ 5ë¶„ê°„ ìœ íš¨í•˜ë„ë¡ ì§€ì •í–ˆìœ¼ë©°, ì‹œê°„ì„ ì´ˆê³¼í•œ ê²½ìš° ì¬ì¸ì¦ ìš”ì²­ ë©”ì‹œì§€ ì¶œë ¥

(ì‚¬ì§„)

- ê°œì¸ë³„ ë§ì¶¤ ì˜í™” ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ì„ ìœ„í•œ ë°ì´í„° ìˆ˜ì§‘
- ì‚¬ìš©ìê°€ ì„ íƒí•œ ì¥ë¥´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¸ê¸° ì˜í™”(TMDB APIì˜ popularity ê¸°ì¤€) ì¤‘ ì¼ë¶€ë¥¼ ëœë¤ìœ¼ë¡œ ì œê³µ
- ë™ì¼í•œ ìš”ì²­ì— ëŒ€í•´ Django ìºì‹±ì„ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ ë¹„ìš© ì ˆê° (1ì‹œê°„ ìœ íš¨)


### âš™ ë¡œê·¸ì¸

(ì‚¬ì§„)

- ì¡´ì¬í•˜ì§€ ì•ŠëŠ” username ë˜ëŠ” passwordê°€ í‹€ë ¸ì„ ê²½ìš° ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥

### âš™ ìë™ ì™„ì„± ê²€ìƒ‰ ë° í•„í„°ë§

(ì‚¬ì§„)

- Lodashì˜ debounceë¥¼ í™œìš©í•˜ì—¬ ê³¼ë„í•œ API í˜¸ì¶œ ë°©ì§€ (200ms ì ìš©)
- í‚¤ë³´ë“œ íƒìƒ‰ ë° ë§ˆìš°ìŠ¤ í´ë¦­ìœ¼ë¡œ ê²€ìƒ‰ì–´ì„ ì„ íƒí•˜ì—¬ UX í–¥ìƒ  
  
(ì‚¬ì§„)

- ì¤‘ë³µ ì¡°íšŒë¥¼ ì œê³µí•˜ì—¬ ë‹¤ì–‘í•œ ì˜í™” í•„í„°ë§ ê°€ëŠ¥
- í•„í„°ë§ëœ ì˜í™”ì— ëŒ€í•˜ì—¬ ê°œë´‰ì¼, ë¦¬ë·° ìˆ˜, ì¶”ì²œ ìˆ˜, ì¸ê¸°(TMDB APIì˜ popularity)ìˆœìœ¼ë¡œ ì •ë ¬ ì œê³µ

(ì‚¬ì§„)
- í˜ì´ì§• ì²˜ë¦¬ê°€ í•„ìš”í•œ ê²½ìš° Pagination ì»´í¬ë„ŒíŠ¸ë¥¼ ê³µìœ í•˜ì—¬ êµ¬í˜„

### âš™ ë‚´ ì£¼ë³€ ì˜í™”ê´€ ì°¾ê¸°

(ì‚¬ì§„)

- KAKAO MAP APIë¥¼ í™œìš©í•˜ì—¬ í˜„ì¬ ë‚´ ìœ„ì¹˜ë¥¼ ì¸ì‹í•˜ê³  ì£¼ë³€ ì˜í™”ê´€ì„ ë§ˆì»¤ë¡œ í‘œì‹œ
- ë§ˆì»¤ í´ë¦­ ì‹œ ê°„ë‹¨í•œ ì •ë³´ í™•ì¸ ê°€ëŠ¥ (ì´ë¦„, ì£¼ì†Œ, ì „í™”ë²ˆí˜¸, ìƒì˜ì‹œê°„í‘œ ë§í¬)
- ìƒì˜ ì‹œê°„í‘œ í´ë¦­ ì‹œ í•´ë‹¹ ì˜í™”ê´€ì˜ ë„¤ì´ë²„ ìƒì˜ ì‹œê°„í‘œ ê²€ìƒ‰ í˜ì´ì§€ë¡œ ì´ë™
- ë™ì  ì§€ë„ ì—…ë°ì´íŠ¸ : ì§€ë„ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ ì¤Œì„ ì¡°ì •í•˜ëŠ” ì‚¬ìš©ìì˜ ì´ë²¤íŠ¸ì— ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì‘í•˜ì—¬ ìƒˆë¡œìš´ ì¤‘ì‹¬ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì˜í™”ê´€ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê²€ìƒ‰í•˜ê³  ë§ˆì»¤ ê°±ì‹ 

### âš™ ë°•ìŠ¤ ì˜¤í”¼ìŠ¤ ìˆœìœ„

(ì‚¬ì§„)

- ì˜í™” ì œëª©, ìˆœìœ„, í¬ìŠ¤í„° ì´ë¯¸ì§€ë¥¼ ì–»ê¸° ìœ„í•´ TMDB APIì™€ ì˜í™”ì§„í¥ìœ„ì›íšŒ APIë¥¼ ê²°í•©
- ì˜í™” ì œëª©ì— íŠ¹ìˆ˜ë¬¸ìê°€ ìˆëŠ” ê²½ìš° ì œê±°í•œ ë’¤ ê°œë´‰ì¼ê³¼ ê°€ì¥ ê·¼ì ‘í•œ ì˜í™” ë°ì´í„° í•„í„°ë§ 
- ë™ì¼í•œ ìš”ì²­ì— ëŒ€í•´ Django ìºì‹±ì„ ì‚¬ìš©í•˜ì—¬ ë™ì¼ ìš”ì²­ ì‹œ API í˜¸ì¶œ ìµœì†Œí™” (8ì‹œê°„ ìœ íš¨)



### âš™ ì˜í™” ìƒì„¸ í˜ì´ì§€

(ì‚¬ì§„)

- ìƒì„¸ í˜ì´ì§€ì—ì„œ ì œê³µí•˜ëŠ” ëª¨ë“  ë°ì´í„°ëŠ” TMDB APIë¥¼ í™œìš©
- ì˜í™” ì œëª©, ì›ì œ, ê°œë´‰ì¼, ì¥ë¥´, êµ­ê°€, ìƒì˜ ì‹œê°„, ê°ìƒ ê°€ëŠ¥ OTT, í¬ìŠ¤í„°, ì¤„ê±°ë¦¬, íƒœê·¸ë¼ì¸, ê°ë…, ë°°ìš° ì •ë³´ ì œê³µ

(ì‚¬ì§„)
- íšŒì›ê°€ì…í•œ ì‚¬ìš©ìì˜ ê²½ìš° ì˜í™”ì— ì¶”ì²œ ê°€ëŠ¥
- ì¶”ì²œ ë° ì¶”ì²œ ì·¨ì†Œê°€ ê°€ëŠ¥í•œ í† ê¸€ ë²„íŠ¼ì„ í†µí•´ ê°’ì„ ë³€ê²½í•  ë•Œë§ˆë‹¤ ë™ì ìœ¼ë¡œ ì•„ì´ì½˜ ë³€ê²½ 
  
(ì‚¬ì§„)
- Vueì˜ Chart.jsë¥¼ í†µí•´ ì‚¬ìš©ìë“¤ì´ ë¦¬ë·° ì‘ì„± ì‹œ í‰ê°€í•œ ratingì˜ ë¶„í¬ë„ë¥¼ ê·¸ë˜í”„ë¡œ í‘œí˜„ 
- ê°€ì¥ ë†’ì€ ë¶„í¬ì— í•´ë‹¹í•˜ëŠ” ë³„ì  ê°•ì¡° 
  
(ì‚¬ì§„)
- ë¦¬ë·° ì „ì²´ì˜ í‰ê· ê°’ê³¼ í•¨ê»˜ ì¶”ì²œì´ ë†’ì€ ìˆœìœ¼ë¡œ ë‹¤ì„¯ ê°œì˜ ë¦¬ë·° ë…¸ì¶œ 
  
(ì‚¬ì§„)
- ë™ì˜ìƒ ì¸ë„¤ì¼ í´ë¦­ ì‹œ ëª¨ë‹¬ë¡œ ë°”ë¡œ ì¬ìƒ ê°€ëŠ¥

### âš™ ì»¤ë®¤ë‹ˆí‹°

(ì‚¬ì§„)
- ë§ˆìš°ìŠ¤ ì˜¤ë²„ë¥¼ í†µí•´ ì‚¬ìš©ìê°€ ì„ íƒí•˜ëŠ” ratingì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€
- ê¸€ììˆ˜ê°€ ì œí•œë  ê²½ìš° ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ë©° ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™”

(ì‚¬ì§„)
- ìŠ¤í¬ì¼ëŸ¬ê°€ ì²´í¬ëœ ê²½ìš° ë‚´ìš©ì´ ë¸”ëŸ¬ë¡œ ì²˜ë¦¬ë˜ë©° í´ë¦­ ì‹œ í™•ì¸ ê°€ëŠ¥
- ë³¸ì¸ì´ ì‘ì„±í•œ ë¦¬ë·°ë§Œ ìˆ˜ì •, ì‚­ì œ ë²„íŠ¼ ë…¸ì¶œ
  
(ì‚¬ì§„)
- ê° ë¦¬ë·°ì— ëŒ€í•œ ëŒ“ê¸€ ëª©ë¡ì€ ë¬´í•œ ìŠ¤í¬ë¡¤ì´ ì ìš©ëœ ëª¨ë‹¬ì°½ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥
- ëŒ“ê¸€, ëŒ€ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìœ¼ë©° ë³¸ì¸ì´ ì‘ì„±í•œ ëŒ“ê¸€, ëŒ€ëŒ“ê¸€ì—ë§Œ ì‚­ì œ ë²„íŠ¼ ë…¸ì¶œ
- í™”ì‚´í‘œ í´ë¦­ ì‹œ ëŒ€ëŒ“ê¸€ ì‘ì„±ì°½ í™œì„±í™”


### âš™ ìœ ì € í˜ì´ì§€

(ì‚¬ì§„)
- ë³¸ì¸ì˜ í˜ì´ì§€ì—ì„œë§Œ í”„ë¡œí•„ ì‚¬ì§„ í¸ì§‘ ë²„íŠ¼ ë…¸ì¶œ
- íŒ”ë¡œìš°, íŒ”ë¡œì‰ ìˆ˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©° ë²„íŠ¼ì„ í† ê¸€í•  ë•Œë§ˆë‹¤ ì‹¤ì‹œê°„ìœ¼ë¡œ í˜„ì¬ ìˆ«ì ë°˜ì˜
  
(ì‚¬ì§„)
- í´ë¦­ ì‹œ íŒ”ë¡œìš°, íŒ”ë¡œì‰ ëª©ë¡ í™•ì¸ ê°€ëŠ¥
  
(ì‚¬ì§„)
- Vueì˜ Chart.jsë¥¼ í†µí•´ í•´ë‹¹ ì‚¬ìš©ìì˜ ë³„ì  ë¶„í¬ë„ë¥¼ ê·¸ë˜í”„ë¡œ í™•ì¸ ê°€ëŠ¥

(ì‚¬ì§„)
- í•´ë‹¹ ì‚¬ìš©ìì˜ ì¶”ì²œ ì˜í™”, ì‘ì„± ë¦¬ë·°, ëŒ“ê¸€ ëª©ë¡ í™•ì¸ ê°€ëŠ¥ 
  
(ì‚¬ì§„)
- ì •ë³´ ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì°½ìœ¼ë¡œ ì´ë™í•˜ë©° dj-rest-authê°€ ì œê³µí•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ í™œìš©


### âš™ ê°œì¸ë³„ ì˜í™” ì¶”ì²œ 

(ì‚¬ì§„)
- í˜‘ì—… í•„í„°ë§ ë° ì½˜í…ì¸  ê¸°ë°˜ ì•Œê³ ë¦¬ì¦˜ ê²°í•©
- í•˜ë‹¨ ì„¤ëª… ì°¸ê³ 

## ğŸ“ˆ ì˜í™” ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ 

### ëª©ì 
- ì‚¬ìš©ìì˜ ë¦¬ë·°, ì¶”ì²œ, ì˜í™” ì†ì„±ì„ ê¸°ë°˜ìœ¼ë¡œ ì¢‹ì•„í•  ë§Œí•œ ì˜í™” ì¶”ì²œí•˜ê¸°
  
### ì‹¤í–‰ íë¦„

#### 1. ì‚¬ìš©ì ìœ ì‚¬ì„± ê³„ì‚° - í˜‘ì—… í•„í„°ë§

```python
def calculate_user_similarity(user_reviews, candidate_reviews, user_likes, candidate_likes):

    # ì‚¬ìš©ì ë¦¬ë·° ë°ì´í„°ë¥¼ ì˜í™” IDë¥¼ í‚¤ë¡œ í•˜ëŠ” ë”•ì…”ë„ˆë¦¬ë¡œ ì •ë¦¬
    user_ratings = {movie_id: rating for movie_id, rating in user_reviews}    # í˜„ì¬ ì‚¬ìš©ìê°€ í‰ê°€í•œ ì˜í™”ì™€ í‰ì  ëª©ë¡
    candidate_ratings = {movie_id: rating for movie_id, rating in candidate_reviews}   # ë¹„êµí•  ì‚¬ìš©ìê°€ í‰ê°€í•œ ì˜í™”ì™€ í‰ì  ëª©ë¡

    # ë‘ ì‚¬ìš©ìë“¤ì˜ ê³µí†µ ë¦¬ë·° ì˜í™” ì¶”ì¶œ
    common_movies = set(user_ratings.keys()) & set(candidate_ratings.keys())
    if not common_movies:
        return 0  # ê³µí†µ ì˜í™”ê°€ ì—†ìœ¼ë©´ ìœ ì‚¬ë„ 0

    # ì¶”ì²œí•œ ì˜í™”ì— ê°€ì¤‘ì¹˜ë¥¼ ë¶€ì—¬
    for movie_id in common_movies:
        if movie_id in user_likes:
            user_ratings[movie_id] *= 1.5       # ì¶”ì²œí•œ ì˜í™”ì— ê°€ì¤‘ì¹˜ 1.5ë°°
        if movie_id in candidate_likes:
            candidate_ratings[movie_id] *= 1.5  # ì¶”ì²œí•œ ì˜í™”ì— ê°€ì¤‘ì¹˜ 1.5ë°°

    # ê°€ì¤‘ì¹˜ê°€ ë°˜ì˜ëœ í‰ì ì„ ì‚¬ìš©í•´ ë‘ ì‚¬ìš©ìì˜ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚°
    # ë‘ ì‚¬ìš©ìê°€ ê³µí†µìœ¼ë¡œ í‰ê°€í•œ ì˜í™”ì—ì„œ í‰ì ì´ ì–¼ë§ˆë‚˜ ë¹„ìŠ·í•œì§€ ì¸¡ì •
    user_vector = [user_ratings[movie] for movie in common_movies]
    candidate_vector = [candidate_ratings[movie] for movie in common_movies]

    similarity = 1 - cosine(user_vector, candidate_vector)
    return similarity if not np.isnan(similarity) else 0    # ê³„ì‚°ëœ ìœ ì‚¬ë„ ë°˜í™˜
```

```python
def get_similar_users(user, threshold=0.5):
    # í˜„ì¬ ì‚¬ìš©ì ë¦¬ë·° ë° ì¶”ì²œ ë°ì´í„° ë¡œë“œ
    user_reviews = list(Review.objects.filter(user=user).values_list('movie_id', 'rating'))
    user_likes = set(user.like_movies.values_list('id', flat=True))

    # ëª¨ë“  ë¦¬ë·°ì™€ ì¶”ì²œ ë°ì´í„°ë¥¼ ë‹¨ì¼ ì¿¼ë¦¬ë¡œ ë¡œë“œ
    reviews = Review.objects.exclude(user=user).select_related('user')    # ëª¨ë“  ë¦¬ë·° ë°ì´í„°ë¥¼ ë¡œë“œí•˜ì—¬ ì‚¬ìš©ìë³„ë¡œ ê·¸ë£¹í™”
    likes = User.objects.exclude(id=user.id).prefetch_related(            # ëª¨ë“  ì¶”ì²œ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ì—¬ ì‚¬ìš©ìë³„ë¡œ ê·¸ë£¹í™”
        Prefetch('like_movies', queryset=Movie.objects.all(), to_attr='prefetched_likes')
    )

    # ëª¨ë“  ë¦¬ë·° ë°ì´í„°ë¥¼ ì‚¬ìš©ìë³„ë¡œ ê·¸ë£¹í™”
    all_reviews = defaultdict(list)
    for review in reviews:
        all_reviews[review.user_id].append((review.movie_id, review.rating))

    # ì¶”ì²œ ë°ì´í„°ë¥¼ ì‚¬ìš©ìë³„ë¡œ ê·¸ë£¹í™”
    all_likes = {user.id: {movie.id for movie in user.prefetched_likes} for user in likes}

    # ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ê³¼ì˜ ìœ ì‚¬ì„±ì„ ê³„ì‚°
    similar_users = []
    for candidate_user, candidate_reviews in all_reviews.items():
        candidate_likes = all_likes.get(candidate_user, set())
        similarity = calculate_user_similarity(user_reviews, candidate_reviews, user_likes, candidate_likes)
        # ê¸°ì¤€ê°’ ì´ìƒì´ë©´ ìœ ì‚¬í•œ ì‚¬ìš©ìë¡œ íŒë‹¨
        if similarity >= threshold:
            similar_users.append(candidate_user)

    return similar_users
```

(1) **ë°ì´í„° ìˆ˜ì§‘ ë° ì •ë¦¬**:
   - í˜„ì¬ ì‚¬ìš©ìì™€ ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ì˜ ë¦¬ë·° ë° ì¶”ì²œ ë°ì´í„° ìˆ˜ì§‘
   - ì˜í™” IDë¥¼ keyë¡œ ê°–ëŠ” ë”•ì…”ë„ˆë¦¬ë¡œ ì •ë¦¬í•˜ì—¬ ë¹„êµ
  

(2) **ê³µí†µ ë¦¬ë·° ì˜í™” ì¶”ì¶œ**:
   - í˜„ì¬ ì‚¬ìš©ìì™€ ë¹„êµ ëŒ€ìƒ ì‚¬ìš©ìê°€ ê³µí†µìœ¼ë¡œ í‰ê°€í•œ ì˜í™” í•„í„°ë§
  

(3) **ê°€ì¤‘ì¹˜ ì ìš©**:
   - ì¶”ì²œ ì˜í™”ì— ëŒ€í•´ í‰ì ì— ê°€ì¤‘ì¹˜(1.5ë°°)ë¥¼ ë¶€ì—¬í•˜ì—¬ ì¶”ì²œ ì˜í™”ì— ëŒ€í•œ ìœ ì‚¬ì„±ì„ ë” ë†’ê²Œ í‰ê°€

(4) **ìœ ì‚¬ë„ ê³„ì‚°**:
   - ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ ì‚¬ìš©ìì™€ ë‹¤ë¥¸ ì‚¬ìš©ì ê°„ì˜ ìœ ì‚¬ì„±ì„ ì¸¡ì •
   - ìœ ì‚¬ë„ ê¸°ì¤€(`threshold=0.5`) ì´ìƒì¸ ì‚¬ìš©ìë§Œ ìœ ì‚¬ ì‚¬ìš©ìë¡œ ê°„ì£¼

---

#### 2. ìœ ì‚¬ ì‚¬ìš©ì ê¸°ë°˜ ì¶”ì²œ

```python
def collaborative_filtering_recommendations(user, exclude_movies=set(), max_recommendations=10):
    # ì·¨í–¥ì´ ë¹„ìŠ·í•œ íšŒì› ì°¾ê¸°
    similar_user_ids = get_similar_users(user, threshold=0.5)

    # í•´ë‹¹ íšŒì›ë“¤ì´ ì¢‹ì•„í•œ ì˜í™”ë¥¼ DBì—ì„œ ê²€ìƒ‰
    '''
    ì¢‹ì•„í•œë‹¤ì˜ ê¸°ì¤€
    - í‰ì ì˜ í‰ê·  (avg_rating) -> í‰ê·  í‰ì ì´ 3.5 ì´ìƒì¸ ì˜í™” ì¤‘, í‰ì ì´ ë†’ì„ ìˆ˜ë¡ ì¢‹ì•„í•˜ëŠ” ì˜í™”ë¡œ ê°„ì£¼ (ìš°ì„  ìˆœìœ„ 1)
    - ì˜í™”ë¥¼ ì¶”ì²œí•œ ì‚¬ëŒë“¤ì˜ ìˆ˜ (like_count) -> ì¶”ì²œì´ ë§ì„ìˆ˜ë¡ ì¢‹ì•„í•˜ëŠ” ì˜í™”ë¡œ ê°„ì£¼ (ìš°ì„  ìˆœìœ„ 2)
    - ì˜í™” ìì²´ì˜ ì¸ê¸°ë„ (calculated_popularity) -> ì¶”ê°€ì ì¸ ê°€ì¤‘ì¹˜ ë¶€ì—¬ (ìš°ì„  ìˆœìœ„ 3)
    '''
    recommended_movies = Movie.objects.filter(
        review__user__in=similar_user_ids
    ).exclude(
        id__in=exclude_movies        # í˜„ì¬ ì‚¬ìš©ìê°€ ì´ë¯¸ ë³¸ ì˜í™”ëŠ” ì¶”ì²œì—ì„œ ì œì™¸
    ).distinct().prefetch_related(
        'directors', 'genres', 'actors', 'likes'
    ).annotate(
        avg_rating=Avg('review__rating'),
        like_count=Count('likes'),
        calculated_popularity=F('popularity')
    ).filter(
        avg_rating__gte=3.5  # í‰ê·  í‰ì ì´ 3.5 ë¯¸ë§Œì¸ ê²½ìš° ì¶”ì²œì—ì„œ ì œì™¸ 
    ).order_by(
        '-avg_rating', '-like_count', '-calculated_popularity'
    )[:max_recommendations]  # ì •ë ¬ ê¸°ì¤€: í‰ê·  í‰ì (avg_rating) > ì¢‹ì•„ìš” ìˆ˜(like_count) > ì˜í™” ì¸ê¸°ë„(calculated_popularity)

    # ì •ë ¬ëœ ì˜í™” ì¤‘ì—ì„œ ìµœëŒ€ max_recommendations ê°œìˆ˜ë§Œ ë°˜í™˜
    return recommended_movies
```

(1) **ìœ ì‚¬ ì‚¬ìš©ì IDë¡œ ì˜í™” í•„í„°ë§**:
   - ìœ ì‚¬ ì‚¬ìš©ìë“¤ì´ ì¢‹ì•„í•œ ì˜í™” ë°ì´í„° ì¡°íšŒ
   - í˜„ì¬ ì‚¬ìš©ìê°€ ì´ë¯¸ ë³¸ ì˜í™”ëŠ” ì œì™¸

(2) **ì¶”ì²œ ê¸°ì¤€**:
   - **í‰ê·  í‰ì (avg_rating)**: 3.5 ì´ìƒ
   - **ì¶”ì²œ ìˆ˜(like_count)**: ì¶”ì²œì´ ë§ì€ ì˜í™”
   - **ì˜í™” ì¸ê¸°ë„(calculated_popularity)**: ì¶”ê°€ ê°€ì¤‘ì¹˜

(3) **ì •ë ¬ ê¸°ì¤€**:
   - í‰ê·  í‰ì  > ì¶”ì²œ ìˆ˜ > ì¸ê¸°ë„ ìˆœìœ¼ë¡œ ì •ë ¬ í›„ ìµœëŒ€ `max_recommendations`(ê¸°ë³¸ 10ê°œ) ë°˜í™˜.

---

#### 3. ì½˜í…ì¸  ê¸°ë°˜ ì¶”ì²œ

```python
def content_based_recommendations(user, exclude_movies=set(), max_recommendations=10):

    # ì‚¬ìš©ìê°€ ë¦¬ë·°ë¥¼ ë‚¨ê¸´ ì˜í™” ì¤‘ í‰ì ì´ 3.5 ì´ìƒì¸ ì˜í™” ì¡°íšŒ
    high_rated_movies = Review.objects.filter(user=user, rating__gte=3.5).values_list('movie', flat=True)

    # ì‚¬ìš©ìê°€ ì¶”ì²œí•œ ì˜í™” ì¡°íšŒ
    liked_movies = user.like_movies.values_list('id', flat=True)

    # ë¦¬ë·°í•œ ì˜í™”ì™€ ì¶”ì²œí•œ ì˜í™” ë°ì´í„°ë¥¼ í•©ì³ ì„ í˜¸ ì˜í™” ëª©ë¡ ìƒì„±
    preferred_movies = set(high_rated_movies).union(set(liked_movies))

    # ì„ í˜¸ ì†ì„±(ì¥ë¥´, ë°°ìš°, ê°ë…) ì¶”ì¶œ
    preferred_genres = Genre.objects.filter(movies__in=preferred_movies).distinct()
    preferred_actors = Actor.objects.filter(movies__in=preferred_movies).distinct()
    preferred_directors = Director.objects.filter(movies__in=preferred_movies).distinct()

    # ì‚¬ìš©ìì˜ ì„ í˜¸ ì¥ë¥´, ë°°ìš°, ê°ë…ê³¼ ê²¹ì¹˜ëŠ” ì˜í™” í•„í„°ë§
    recommended_movies = Movie.objects.filter(
        Q(genres__in=preferred_genres) |
        Q(actors__in=preferred_actors) |
        Q(directors__in=preferred_directors)
    ).exclude(
        id__in=exclude_movies        # í˜„ì¬ ì‚¬ìš©ìê°€ ë¦¬ë·°ë¥¼ ë‚¨ê²¼ê±°ë‚˜ ì¶”ì²œí•œ ì˜í™”ëŠ” ì œì™¸
    ).distinct().prefetch_related(
        'directors', 'genres', 'actors', 'likes'
    ).annotate(
        avg_rating=Avg('review__rating'),  # í‰ê·  í‰ì  ê³„ì‚°
        like_count=Count('likes'),         # ì¶”ì²œ ìˆ˜ ê³„ì‚°
        score=F('popularity')              # ì¸ê¸°ë„ ê°€ì ¸ì˜¤ê¸°  
    ).order_by(
        '-score'             # ì •ë ¬ ê¸°ì¤€: ì¸ê¸°ë„(score) > í‰ê·  í‰ì (avg_rating) > ì¶”ì²œ ìˆ˜(like_count)
    )[:max_recommendations]  # ìµœëŒ€ max_recommendations ê°œìˆ˜ë§Œ ë°˜í™˜

    return recommended_movies
```
(1) **ì‚¬ìš©ì ì„ í˜¸ ë°ì´í„° ë¶„ì„**:
   - í‰ì ì´ 3.5 ì´ìƒì¸ ì˜í™” ë° ì¶”ì²œí•œ ì˜í™”ì˜ ì†ì„±(ì¥ë¥´, ë°°ìš°, ê°ë…)ì„ ì¶”ì¶œ
   - ì„ í˜¸ ì†ì„±ì„ ê¸°ì¤€ìœ¼ë¡œ ìœ ì‚¬í•œ ì˜í™” í•„í„°ë§

(2) **ì¶”ì²œ ê¸°ì¤€**:
   - ì‚¬ìš©ìì˜ ì„ í˜¸ ì¥ë¥´, ë°°ìš°, ê°ë…ê³¼ ê²¹ì¹˜ëŠ” ì˜í™”ë§Œ ì¶”ì²œ
   - í‰ê·  í‰ì , ì¶”ì²œ ìˆ˜, ì¸ê¸°ë„ë¥¼ í™œìš©í•˜ì—¬ ì •ë ¬

(3) **ì •ë ¬ ê¸°ì¤€**:
   - ì¸ê¸°ë„ > í‰ê·  í‰ì  > ì¶”ì²œ ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬ í›„ ìµœëŒ€ `max_recommendations` ë°˜í™˜

---

#### 4. ê²°ê³¼ ë³‘í•©

```python
def get_combined_recommendations(user, max_recommendations=15):
    cache_key = f"user_{user.id}_recommendations"
    cached_recommendations = cache.get(cache_key)

    if cached_recommendations:
        print('ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ : ìºì‹œëœ ë°ì´í„° ì‚¬ìš©')
        return cached_recommendations

    # ì‚¬ìš©ìê°€ ì´ë¯¸ ë¦¬ë·°í•œ ì˜í™” ë° ì¶”ì²œí•œ ì˜í™” ì œì™¸
    exclude_movies = set(
        Review.objects.filter(user=user).values_list('movie_id', flat=True)
    ).union(
        user.like_movies.values_list('id', flat=True) 
    )

    # í˜‘ì—… í•„í„°ë§ ì¶”ì²œ : ìœ ì‚¬í•œ ì‚¬ìš©ìë“¤ì´ ì¢‹ì•„í•œ ì˜í™”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¶”ì²œ
    collab_recommendations = collaborative_filtering_recommendations(user, exclude_movies, max_recommendations)

    # ì½˜í…ì¸  ê¸°ë°˜ ì¶”ì²œ : ì‚¬ìš©ìê°€ ì¢‹ì•„í•˜ëŠ” ì˜í™”ì˜ ì¥ë¥´, ë°°ìš°, ê°ë…ê³¼ ë¹„ìŠ·í•œ ì˜í™”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¶”ì²œ
    content_recommendations = content_based_recommendations(user, exclude_movies, max_recommendations)

    # ì¤‘ë³µ ì œê±° ë° ê°€ì¤‘ì¹˜ ì ìš© í›„ ë³‘í•©
    collab_weight = 1   # í˜‘ì—… í•„í„°ë§ ê°€ì¤‘ì¹˜
    content_weight = 3  # ì½˜í…ì¸  ê¸°ë°˜ ì¶”ì²œ ê°€ì¤‘ì¹˜ (ê°€ì¤‘ì¹˜ë¥¼ ë” ë†’ê²Œ ì„¤ì •)

    weighted_collab_ids = [movie.id for movie in collab_recommendations] * collab_weight
    weighted_content_ids = [movie.id for movie in content_recommendations] * content_weight

    combined_movie_ids = set(weighted_collab_ids + weighted_content_ids)

    # ìµœì¢…ì ìœ¼ë¡œ ì¶”ì²œí•  ì˜í™” ëª©ë¡ ì¡°íšŒ 
    combined_movies = Movie.objects.filter(
        id__in=combined_movie_ids
    ).annotate(
        avg_rating=Avg('review__rating'),
        like_count=Count('likes'),
        calculated_popularity=F('popularity')
    ).order_by('-calculated_popularity', '-avg_rating', '-like_count')[:max_recommendations]   # ì¸ê¸°ë„(calculated_popularity) > í‰ê·  í‰ì (avg_rating) > ì¶”ì²œ ìˆ˜(like_count) ìˆœìœ¼ë¡œ ì •ë ¬

    # ìºì‹œì— ì €ì¥ (ê¸°ë³¸ 15ë¶„)
    cache.set(cache_key, combined_movies, 60 * 15)

    return combined_movies
```
(1) **í˜‘ì—… í•„í„°ë§ê³¼ ì½˜í…ì¸  ê¸°ë°˜ ì¶”ì²œ ê²°í•©**:
   - ë‘ ì•Œê³ ë¦¬ì¦˜ ê²°ê³¼ì—ì„œ ì˜í™” IDë¥¼ ê°€ì ¸ì™€ ê°€ì¤‘ì¹˜ ì ìš©:
     - í˜‘ì—… í•„í„°ë§(ê°€ì¤‘ì¹˜ 1)
     - ì½˜í…ì¸  ê¸°ë°˜ ì¶”ì²œ(ê°€ì¤‘ì¹˜ 3)
     - íšŒì›ê°€ì… ì‹œ ì˜í™”ë¥¼ ì„ íƒí•˜ë„ë¡ ì„¤ê³„í•˜ì˜€ì§€ë§Œ ë°ì´í„°ê°€ ë§ì§€ ì•Šì€ ì†Œê·œëª¨ í”„ë¡œì íŠ¸ì¸ ê²ƒì„ ê°ì•ˆí•˜ì—¬ ì½˜í…ì¸  ê¸°ë°˜ ì¶”ì²œì— ê°€ì¤‘ì¹˜ë¥¼ ë” ë‘ì—ˆìŒ

(2) **ì¤‘ë³µ ì œê±° ë° ìµœì¢… ì •ë ¬**:
   - ì¤‘ë³µëœ ì˜í™” IDë¥¼ ì œê±°í•˜ê³  ìµœì¢…ì ìœ¼ë¡œ ì •ë ¬:
     - ì¸ê¸°ë„ > í‰ê·  í‰ì  > ì¶”ì²œ ìˆ˜ ìˆœì„œ

(3) **ìµœì¢… ê²°ê³¼ ë°˜í™˜**:
   - ìƒìœ„ `max_recommendations`(ê¸°ë³¸ 15ê°œ) ì˜í™” ë°ì´í„°ë¥¼ ë°˜í™˜

#### 5. ì„±ëŠ¥

(1) ì¿¼ë¦¬ íŠœë‹

![ì „](https://github.com/user-attachments/assets/d99582ce-c155-466d-9381-d6e9d0dd35a0)
![í›„](https://github.com/user-attachments/assets/c30f34ad-76a2-4b8b-a6ed-f492813313ca)


| í•­ëª©            | ì´ˆê¸° ì„±ëŠ¥      | ê°œì„ ëœ ì„±ëŠ¥       | ê°œì„ ìœ¨          |
|-----------------|---------------|--------------|----------------|
| **Overall**     | 850ms         | 298ms         | ì•½ 64.94%       |
| **Queries ì‹œê°„** | 170ms         | 40ms         | ì•½ 76.47%       |
| **Query ìˆ˜**     | 264 queries   | 15 queries     | ì•½ 94.32%       |

- Djangoì˜ Silk ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ API í˜¸ì¶œ ì‹œ ìˆ˜í–‰ë˜ëŠ” ì¿¼ë¦¬ ì„±ëŠ¥ í‰ê°€ ì‹¤ì‹œ
- íŠœë‹ ì „(ì¢Œì¸¡)ê³¼ í›„(ìš°ì¸¡) ë¹„êµ ì°¸ê³ 
  
<br>

(2) ìºì‹±

```python
cache.set(cache_key, combined_movies, 60 * 15)
```

- ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ì— ëŒ€í•œ ìºì‹± ìœ íš¨ ì‹œê°„ì€ 15ë¶„ìœ¼ë¡œ ì§€ì •
- ì¿¼ë¦¬ ìµœì í™”ë¥¼ í•˜ì˜€ìœ¼ë‚˜ ì—¬ëŸ¬ ì‚¬ìš©ìì™€ ì˜í™” ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì— ë™ì¼ ìš”ì²­ì— ëŒ€í•œ ë°˜ë³µ ê³„ì‚°ì„ ì¤„ì¼ í•„ìš”ê°€ ìˆë‹¤ê³  íŒë‹¨
  

```python
def save(self, *args, **kwargs):
        is_new = self.pk is None
        old_rating = None

        if not is_new:  
            original = Review.objects.get(pk=self.pk)
            old_rating = original.rating

        super().save(*args, **kwargs)

        if is_new or (old_rating is not None and old_rating != self.rating):
            cache_key = f"user_{self.user.id}_recommendations"
            cache.delete(cache_key)

    def delete(self, *args, **kwargs):
        cache_key = f"user_{self.user.id}_recommendations"
        cache.delete(cache_key)
        super().delete(*args, **kwargs)
```

- ê·¸ëŸ¬ë‚˜ íŠ¹ì • ì‚¬ìš©ì í–‰ë™ì´ ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ì˜ ê²°ê³¼ì— ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆëŠ” ê²½ìš° ìºì‹œ ë¬´íš¨í™”ë¥¼ í†µí•´ ë™ì ìœ¼ë¡œ ì„¤ì •
     - ê¸°ì¡´ ë¦¬ë·° ìˆ˜ì • ì‹œ rating ê°’ì„ ë³€ê²½í•œ ê²½ìš°
     - ê¸°ì¡´ ë¦¬ë·°ë¥¼ ì‚­ì œí•œ ê²½ìš°
     - ìƒˆë¡œìš´ ë¦¬ë·°ë¥¼ ì‘ì„±í•œ ê²½ìš°

